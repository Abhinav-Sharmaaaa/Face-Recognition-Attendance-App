<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register User</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body data-theme="light"> <!-- Add data-theme attribute -->
    <div class="container glass-container">
        <!-- Theme Toggle Switch -->
        <div class="theme-switch-wrapper">
            <label class="theme-switch" for="checkbox">
                <input type="checkbox" id="checkbox" />
                <div class="slider round"></div>
            </label>
            <em>Toggle Theme</em>
        </div>
        <!-- End Theme Toggle Switch -->
    <h1>Register a User</h1>
    <form id="registerForm" action="/register" method="post" enctype="multipart/form-data">
        Role:
        <select name="role" id="roleSelect" required>
            <option value="Student">Student</option>
            <option value="Staff">Staff</option>
            <option value="Others">Others</option>
        </select><br>

        Name: <input type="text" name="name" required><br>

        <div id="branchDiv">
            Branch:
            <select name="branch" id="branchSelect">
                <option value="">Select Branch</option> <!-- Added default option -->
                <option value="C.S.E.">C.S.E.</option>
                <option value="I.T.">I.T.</option>
            <option value="Electronics">Electronics</option>
            <option value="Mechanical">Mechanical</option>
            <option value="Automobile">Automobile</option>
            <option value="Civil">Civil</option>
            <option value="Pharmacy">Pharmacy</option>
            </select><br>
        </div>

        <div>
            <label for="photo">Capture Photo:</label>
            <video id="video" width="320" height="240" autoplay></video>
            <button type="button" id="snap">Capture</button>
            <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
            <input type="hidden" name="photo" id="photo">
            <img id="capturedPhoto" src="" alt="Captured Photo" style="display:none; width:320px; height:240px;">
            <button type="button" id="reCapture" style="display:none;">Re-capture</button>
        </div>

        <div>
            <label for="uploadPhoto">Or Upload Photo:</label>
            <input type="file" name="uploadPhoto" id="uploadPhoto" accept="image/*">
        </div>

        <button type="submit">Register</button>
    </form>
    <a href="/">Back to Home</a>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const photoInput = document.getElementById('photo');
        const snapButton = document.getElementById('snap');
        const capturedPhoto = document.getElementById('capturedPhoto');
        const reCaptureButton = document.getElementById('reCapture');

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing the camera: ", err);
            });
        snapButton.addEventListener('click', () => {
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const dataURL = canvas.toDataURL('image/png');
            photoInput.value = dataURL; 
            capturedPhoto.src = dataURL; 
            video.style.display = 'none';
            capturedPhoto.style.display = 'block';
            reCaptureButton.style.display = 'block';
        });

       
        reCaptureButton.addEventListener('click', () => {
            video.style.display = 'block'; 
            capturedPhoto.style.display = 'none'; 
            reCaptureButton.style.display = 'none'; 
        });

        // --- Added JavaScript for conditional branch field ---
        const roleSelect = document.getElementById('roleSelect');
        const branchDiv = document.getElementById('branchDiv');
        const branchSelect = document.getElementById('branchSelect');

        function toggleBranchField() {
            const selectedRole = roleSelect.value;
            if (selectedRole === 'Student' || selectedRole === 'Staff') {
                branchDiv.style.display = 'block';
                branchSelect.required = true;
            } else {
                branchDiv.style.display = 'none';
                branchSelect.required = false;
                branchSelect.value = ''; // Clear selection if hidden
            }
        }

        // Initial check on page load
        toggleBranchField();

        // Add event listener
        roleSelect.addEventListener('change', toggleBranchField);
        // --- End of added JavaScript ---


        // Theme switching logic
        const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
        const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;

        if (currentTheme) {
            document.body.setAttribute('data-theme', currentTheme);

            if (currentTheme === 'dark') {
                toggleSwitch.checked = true;
            }
        } else {
            // Default to light theme if no preference is stored
            document.body.setAttribute('data-theme', 'light');
            localStorage.setItem('theme', 'light');
        }

        function switchTheme(e) {
            if (e.target.checked) {
                document.body.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark'); // Save theme preference
            } else {
                document.body.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light'); // Save theme preference
            }
        }

        toggleSwitch.addEventListener('change', switchTheme, false);
    </script>
    </div>
</body>
</html>
